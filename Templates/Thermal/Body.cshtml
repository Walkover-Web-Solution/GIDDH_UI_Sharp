@model InvoiceData.Root
@using InvoiceData
@using System.Net
@using System.Collections.Generic
@using System.Linq
@functions {
    /** Cache for settings to avoid repeated property lookups */
    private readonly Dictionary<string, Setting> _settingCache = new Dictionary<string, Setting>();
    /** Get label text if display = true */
    public string GetLabel(string settingName)
    {
        if (!_settingCache.TryGetValue(settingName, out var setting))
        {
            setting = Model.Settings?.GetType().GetProperty(settingName)?.GetValue(Model.Settings) as Setting;
            _settingCache[settingName] = setting ??= new Setting();
        }
        return setting?.Display == true ? setting?.Label ?? string.Empty : string.Empty;
    }
    /** Get true/false for display */
    public bool GetDisplayStatus(string settingName)
    {
        if (!_settingCache.TryGetValue(settingName, out var setting))
        {
            setting = Model.Settings?.GetType().GetProperty(settingName)?.GetValue(Model.Settings) as Setting;
            _settingCache[settingName] = setting ??= new Setting();
        }
        return setting?.Display == true;
    }
    /** Currency helpers */
    public string GetAccountCurrencyCodeOrSymbol()
    {
        return Model?.CurrencyFormat == "CODE"
        ? Model?.AccountCurrency?.Code ?? string.Empty
        : WebUtility.HtmlDecode(Model?.AccountCurrency?.Symbol) ?? string.Empty;
    }
    public string GetCompanyCurrencyCodeOrSymbol()
    {
        return Model?.CurrencyFormat == "CODE"
        ? Model?.Company?.Currency?.Code ?? string.Empty
        : WebUtility.HtmlDecode(Model?.Company?.Currency?.Symbol) ?? string.Empty;
    }
    public bool IsShowAmountForCompany()
    {
        return Model?.IsMultipleCurrency == true && Model?.DisplayBaseCurrency == true;
    }
}
<main>
    <table class="thermal-invoice-table">
        <tbody>
            <!-- Header Section -->
            <tr>
                <td class="invoice-header">
                    @if (GetDisplayStatus("FormNameInvoice"))
                    {
                        <div>@Model?.Settings?.FormNameInvoice?.Label</div>
                    }
                    @if (GetDisplayStatus("HeaderCompanyName"))
                    {
                        <div class="company-name">@Model?.Settings?.HeaderCompanyName?.Label</div>
                    }
                    @if (GetDisplayStatus("ShowCompanyAddress"))
                    {
                        <div class="company-address">@Model.Company.DefaultAddress</div>
                    }
                    @if (GetDisplayStatus("CompanyTaxNumber"))
                    {
                        <div class="company-tax">
                            @GetLabel("CompanyTaxNumber") @Model?.Company?.TaxNumber
                        </div>
                    }
                </td>
            </tr>
            <!-- Separator -->
            <tr>
                <td class="dotted-separator" colspan="100%"></td>
            </tr>
            <!-- Customer and Voucher Details Section -->
            <tr>
                <td class="details-section">
                    <table class="details-table">
                        <tr>
                            <td class="customer-details">
                                @if (GetDisplayStatus("CustomerName"))
                                {
                                    <div class="customer-name-label">@GetLabel("CustomerName")</div>
                                    <div class="customer-name-value">@Model?.CustomerDetails?.Name</div>
                                }
                            </td>
                            <td class="invoice-details">
                                @if (GetDisplayStatus("VoucherDate"))
                                {
                                    <div class="voucher-date">
                                        <span class="label">@GetLabel("VoucherDate")</span>
                                        <span class="value">@Model?.VoucherDate</span>
                                    </div>
                                }
                                @if (GetDisplayStatus("VoucherNumber"))
                                {
                                    <div class="voucher-number">
                                        <span class="label">@GetLabel("VoucherNumber")</span>
                                        <span class="value">@Model?.VoucherNumber</span>
                                    </div>
                                }
                                @if (GetDisplayStatus("formNameInvoice"))
                                {
                                    <div class="invoice-for">
                                        <span class="label">@GetLabel("formNameInvoice")</span>
                                        <span class="value">@Model?.formNameInvoice</span>
                                    </div>
                                }
                            </td>
                        </tr>
                    </table>
                </td>
            </tr>
            <!-- Separator -->
            <tr>
                <td class="dotted-separator" colspan="100%"></td>
            </tr>
            <!-- Items Table Header -->
            <tr>
                <td class="table-header">
                    <table class="header-table">
                        <tr>
                            @if (GetDisplayStatus("Description"))
                            {
                                <td class="col-description">@GetLabel("Description")</td>
                            }
                            @if (GetDisplayStatus("Quantity"))
                            {
                                <td class="col-qty">@GetLabel("Quantity")</td>
                            }
                            @if (GetDisplayStatus("Rate"))
                            {
                                <td class="col-rate">@GetLabel("Rate")</td>
                            }
                            @if (GetDisplayStatus("Total"))
                            {
                                <td class="col-total">@GetLabel("Total")</td>
                            }
                        </tr>
                    </table>
                </td>
            </tr>
            <!-- Separator -->
            <tr>
                <td class="dotted-separator" colspan="100%"></td>
            </tr>
            <!-- Items Section -->
            @if (Model?.Entries != null && Model.Entries.Any())
            {
                @foreach (var entry in Model.Entries)
                {
                    <tr>
                        <td class="item-row">
                            <table class="item-table">
                                <tr>
                                    <td class="col-description">@entry?.Description</td>
                                    <td class="col-qty">@entry?.Stock?.Quantity?.ToString("N0")</td>
                                    <td class="col-rate">@entry?.Stock?.Rate?.AmountForAccount?.ToString("N2")</td>
                                    <td class="col-total">@entry?.Amount?.AmountForAccount?.ToString("N2")</td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                }
            }
            <!-- Separator -->
            <tr>
                <td class="dotted-separator" colspan="100%"></td>
            </tr>
            <!-- Totals Section -->
            <tr>
                <td class="totals-section">
                    <table class="totals-table">
                        <tr>
                            @if (GetDisplayStatus("TotalQuantity"))
                            {
                                <td class="total-label">
                                    @GetLabel("TotalQuantity")
                                    @Model?.Entries?.Sum(e => e?.Stock?.Quantity ?? 0).ToString("N0")
                                </td>
                            }
                            <td class="total-amounts">
                                <table class="amounts-table">
                                    @if (GetDisplayStatus("Discount"))
                                    {
                                        <tr>
                                            <td class="amount-label">@GetLabel("Discount")</td>
                                            <td class="amount-value">@Model?.Entries?.Sum(e =>
                                                                                            e?.SumOfDiscounts?.AmountForAccount ?? 0).ToString("N2")</td>
                                    </tr>
                                                                        }
                                    @if (GetDisplayStatus("TaxableAmount"))
                                    {
                                        <tr>
                                            <td class="amount-label">@GetLabel("TaxableAmount")</td>
                                            <td class="amount-value">@Model?.TaxableAmount?.AmountForAccount?.ToString("N2")
                                            </td>
                                        </tr>
                                    }
                                    @if (GetDisplayStatus("TaxBifurcation") && Model?.GstTaxesTotal != null &&
                                                                        Model.GstTaxesTotal.Any())
                                    {
                                        @foreach (var tax in Model.GstTaxesTotal)
                                        {
                                            <tr>
                                                <td class="amount-label">@tax?.TaxType@(tax?.TaxPercent?.ToString("N0"))%</td>
                                                <td class="amount-value">@tax?.Amount?.AmountForAccount?.ToString("N2")</td>
                                            </tr>
                                        }
                                    }
                                    @if (GetDisplayStatus("GrandTotal"))
                                    {
                                        <tr class="final-total">
                                            <td class="amount-label">@GetLabel("GrandTotal")</td>
                                            <td class="amount-value">@Model?.GrandTotal?.AmountForAccount?.ToString("N2")
                                            </td>
                                        </tr>
                                    }
                                </table>
                            </td>
                        </tr>
                    </table>
                </td>
            </tr>
            <!-- Amount in Words -->
            <tr>
                <td class="amount-words">
                    @Model?.TotalInWords?.AmountForAccount
                </td>
            </tr>
            <!-- Separator -->
            <tr>
                <td class="dotted-separator" colspan="100%"></td>
            </tr>
            <!-- QR Code Section -->
            @if (GetDisplayStatus("ShowQrCode") && !string.IsNullOrEmpty(Model?.QRCodeBase64String))
            {
                <tr>
                    <td class="qr-code-section">
                        <img src="data:image/png;base64,@Model?.QRCodeBase64String" class="qr-code" />
                    </td>
                </tr>
            }
            <!-- Footer Section -->
            <tr>
                <td class="invoice-footer">
                    <table class="footer-table">
                        <tr>
                            <td class="footer-left">
                                @if (GetDisplayStatus("Thanks"))
                                {
                                    <div>@GetLabel("Thanks")</div>
                                }
                                @if (GetDisplayStatus("Message1"))
                                {
                                    <div>@GetLabel("Message1")</div>
                                }
                            </td>
                            <td class="footer-right">
                                @if (GetDisplayStatus("FooterCompanyName"))
                                {
                                    <div>@Model?.Settings?.FooterCompanyName?.Label</div>
                                }
                            </td>
                        </tr>
                    </table>
                </td>
            </tr>
        </tbody>
    </table>
</main>

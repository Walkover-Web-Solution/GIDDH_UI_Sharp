@model InvoiceData.Root;
@using InvoiceData;
@using System.Collections.Generic;

@functions {
    private readonly Dictionary<string, Setting> _settingCache = new Dictionary<string, Setting>();

    public string GetLabel(string settingName)
    {
        if (!_settingCache.TryGetValue(settingName, out var setting))
        {
            setting = Model.Settings?.GetType().GetProperty(settingName)?.GetValue(Model.Settings) as Setting;
            _settingCache[settingName] = setting ??= new Setting();
        }
        return setting?.Display == true ? setting?.Label ?? string.Empty : string.Empty;
    }

    public bool GetDisplayStatus(string settingName)
    {
        if (!_settingCache.TryGetValue(settingName, out var setting))
        {
            setting = Model.Settings?.GetType().GetProperty(settingName)?.GetValue(Model.Settings) as Setting;
            _settingCache[settingName] = setting ??= new Setting();
        }
        return setting?.Display == true;
    }
}

<header>
    <table>
        <tbody>
            <tr>
                <td class="p-0 border-none">
                    <table>
                        <tbody>
                            <tr>
                                <td class="border-none">
                                    @if (GetDisplayStatus("FormNameInvoice") || GetDisplayStatus("FormNameTaxInvoice"))
                                    {
                                        <h1 class="text-center pdf-title font-weight-500"> 
                                            @if (GetDisplayStatus("FormNameTaxInvoice"))
                                            {
                                                @GetLabel("FormNameTaxInvoice")
                                            }
                                            else
                                            {
                                                @GetLabel("FormNameInvoice")
                                            }
                                        </h1>
                                    }
                                </td>
                            </tr>
                            @if (GetDisplayStatus("DisplayExportMessage"))
                            {
                            <tr>
                                <td class="border-none text-center">
                                    @GetLabel("DisplayExportMessage")
                                </td>
                            </tr>
                            }
                        </tbody>
                    </table>
                    @if (Model?.EInvoiceDetails != null)
                    {
                    <table>
                        <tbody>
                            <tr>
                                @if (GetDisplayStatus("ShowEInvoiceDetails"))
                                {
                            <td class="border-none vertical-align-bottom">
                                <table>
                                    <tbody>
                                        @if (!string.IsNullOrEmpty(Model?.EInvoiceDetails?.IrnNumber))
                                        {
                                        <tr>
                                            <td class="border-none p-0" width="100px">IRN</td>
                                            <td class="border-none p-0">: @Model?.EInvoiceDetails?.IrnNumber</td>
                                        </tr>
                                        }
                                            @if (!string.IsNullOrEmpty(Model?.EInvoiceDetails?.AcknowledgementNumber))
                                            {
                                        <tr>
                                            <td class="border-none p-0" width="100px">Ack No</td>
                                            <td class="border-none p-0">: @Model?.EInvoiceDetails?.AcknowledgementNumber</td>
                                        </tr>
                                            }
                                        @if (!string.IsNullOrEmpty(Model?.EInvoiceDetails?.AcknowledgementDate))
                                        {
                                        <tr>
                                            <td class="border-none p-0" width="100px">Ack Date</td>
                                            <td class="border-none p-0">: @Model?.EInvoiceDetails?.AcknowledgementDate</td>
                                        </tr>
                                        }
                                    </tbody>
                                </table>
                            </td>
                            }
                            @* && !string.IsNullOrEmpty(Model?.QRCodeBase64String) *@
                            @if (GetDisplayStatus("ShowQrCode") && (Model?.IsBusinessToCustomerInvoice == true || Model?.IsBusinessToBusinessInvoice == true))
                            {
                                <td id="qr-code-section" class="border-none text-right vertical-align-bottom">                              
                                @{
                                    var qrCodeSrc = "data:image/png;base64," + Model?.QRCodeBase64String;
                                }
                                    <img src="@qrCodeSrc" class="qr-code-image" width="120px" />
                                </td>
                            }
                            </tr>
                        </tbody>
                    </table>
                    }
                    <table>
                        <tbody>
                            <tr>
                                <td class="p-0 vertical-align-top">
                                    <table class="h-inherit">
                                        <tbody>
                                            <tr>
                                                <td width="50%" class="border-none border-right p-0 vertical-align-top">
                                                    <table>
                                                        @{
                                                            var showCompanyInfo = GetDisplayStatus("ShowLogo") || GetDisplayStatus("ShowCompanyAddress") ||
                                                                 GetDisplayStatus("HeaderCompanyName");
                                                        }
                                                        <tbody>
                                                            @if (showCompanyInfo)
                                                            {
                                                            <tr>
                                                                <td class="border-none">
                                                                    <table>
                                                                        <tbody>
                                                                        <tr>
                                                                            @* && !string.IsNullOrEmpty(Model?.Company?.Logo?.Url) *@
                                                                            @if (GetDisplayStatus("ShowLogo"))
                                                                            {
                                                                                <td class="p-0 border-none pd-r1 vertical-align-top" width="@Model?.Company?.Logo?.Size">
                                                                                    <figure class="m-0">
                                                                                        @* @Model?.Company?.Logo?.Url *@
                                                                                        <img src="data:image/jpeg;base64,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"
                                                                                            width="@Model?.Company?.Logo?.Size" height="auto" />
                                                                                    </figure>
                                                                                </td>
                                                                            }

                                                                            <td class="p-0 border-none vertical-align-top">
                                                                                @if (GetDisplayStatus("HeaderCompanyName"))
                                                                                {
                                                                                    <h2 class="word-break font-weight-500">
                                                                                        @Model?.Company?.Name
                                                                                    </h2>
                                                                                }

                                                                                @if (GetDisplayStatus("ShowCompanyAddress"))
                                                                                {
                                                                                <address>@Model?.Company?.Address</address>
                                                                                }

                                                                                @if (GetDisplayStatus("CompanyTaxNumber"))
                                                                                {
                                                                                <table>
                                                                                    <tr>
                                                                                        <td class="border-none p-0">
                                                                                            @GetLabel("CompanyTaxNumber")
                                                                                        </td>
                                                                                        <td class="border-none p-0">: @Model?.Company?.TaxNumber</td>
                                                                                    </tr>
                                                                                </table>
                                                                                }
                                                                            </td>
                                                                        </tr>
                                                                        </tbody>
                                                                    </table>
                                                                </td>
                                                            </tr>
                                                            }

                                                            @if (GetDisplayStatus("CustomerName"))
                                                            {
                                                            <tr>
                                                                <td class="border-none @(showCompanyInfo ? "border-top" : "")">
                                                                    <table>
                                                                        <tbody>
                                                                            <tr>
                                                                                <td class="border-none p-0" width="100px">
                                                                                    @GetLabel("CustomerName")
                                                                                </td>
                                                                                <td class="border-none p-0">: <strong>@Model?.CustomerDetails?.Name</strong></td>
                                                                            </tr>
                                                                        </tbody>
                                                                    </table>
                                                                </td>
                                                            </tr>
                                                            }

                                                            @if (GetDisplayStatus("ShippingAddress"))
                                                            {
                                                            <tr>
                                                                <td class="border-none @(showCompanyInfo || GetDisplayStatus("CustomerName") ? "border-top" : "")">
                                                                    <p>@GetLabel("ShippingAddress")</p>
                                                                    <p>@Model?.Shipping?.Address</p>
                                                                    <table>
                                                                        <tbody>
                                                                            @if (GetDisplayStatus("ShippingTaxNumber"))
                                                                            {
                                                                            <tr>
                                                                                <td class="border-none p-0" width="100px">
                                                                                        @GetLabel("ShippingTaxNumber")
                                                                                </td>
                                                                                <td class="border-none p-0">: @Model?.Shipping?.TaxNumber</td>
                                                                            </tr>
                                                                            }

                                                                            @if (GetDisplayStatus("ShippingStateCounty"))
                                                                            {
                                                                            <tr>
                                                                                <td class="border-none p-0" width="100px">
                                                                                    @GetLabel("ShippingStateCounty")    
                                                                                </td>
                                                                                <td class="border-none p-0">: @Model?.Shipping?.StateCounty</td>
                                                                            </tr>
                                                                            }

                                                                            @if (GetDisplayStatus("AttentionTo"))
                                                                            {
                                                                            <tr>
                                                                                <td class="border-none p-0" width="100px">
                                                                                    @GetLabel("AttentionTo")
                                                                                </td>
                                                                                <td class="border-none p-0">: @Model?.AttentionTo</td>
                                                                            </tr>
                                                                            }

                                                                            @if (GetDisplayStatus("CustomerEmail"))
                                                                            {
                                                                            <tr>
                                                                                <td class="border-none p-0" width="100px">
                                                                                    @GetLabel("CustomerEmail")
                                                                                </td>
                                                                                <td class="border-none p-0">: @Model?.CustomerDetails?.Email</td>
                                                                            </tr>
                                                                            }

                                                                            @if (GetDisplayStatus("CustomerContactNumber"))
                                                                            {
                                                                            <tr>
                                                                                <td class="border-none p-0" width="100px">@GetLabel("CustomerContactNumber")</td>
                                                                                <td class="border-none p-0">: @Model?.CustomerDetails?.ContactNumber</td>
                                                                            </tr>
                                                                            }
                                                                        </tbody>
                                                                    </table>
                                                                </td>
                                                            </tr>
                                                            }

                                                            @if (GetDisplayStatus("BillingAddress"))
                                                            {
                                                            <tr>
                                                                <td class="border-none @(showCompanyInfo || GetDisplayStatus("CustomerName") || GetDisplayStatus("ShippingAddress") ? "border-top" : "")">
                                                                    <p>@GetLabel("BillingAddress")</p>
                                                                    <p>@Model?.Billing?.Address</p>
                                                                    <table>
                                                                    @if (GetDisplayStatus("BillingTaxNumber"))
                                                                    {
                                                                    <tr>
                                                                        <td class="border-none p-0" width="100px">
                                                                            @GetLabel("BillingTaxNumber")
                                                                        </td>
                                                                        <td class="border-none p-0">: @Model?.Billing?.TaxNumber</td>
                                                                    </tr>
                                                                    }

                                                                    @if (GetDisplayStatus("BillingStateCounty"))
                                                                    {
                                                                    <tr>
                                                                        <td class="border-none p-0" width="100px">
                                                                            @GetLabel("BillingStateCounty")    
                                                                        </td>
                                                                        <td class="border-none p-0">: @Model?.Billing?.StateCounty</td>
                                                                    </tr>
                                                                    }

                                                                    @if (GetDisplayStatus("DisplayPlaceOfSupply"))
                                                                    {
                                                                    <tr>
                                                                        <td class="border-none p-0" width="100px">
                                                                            @GetLabel("DisplayPlaceOfSupply")    
                                                                        </td>
                                                                        <td class="border-none p-0">: @Model?.PlaceOfSupply</td>
                                                                    </tr>
                                                                    }

                                                                    @if (GetDisplayStatus("AttentionTo"))
                                                                    {
                                                                    <tr>
                                                                        <td class="border-none p-0" width="100px">
                                                                            @GetLabel("AttentionTo")
                                                                        </td>
                                                                        <td class="border-none p-0">: @Model?.AttentionTo</td>
                                                                    </tr>
                                                                    }

                                                                    @if (GetDisplayStatus("CustomerEmail"))
                                                                    {
                                                                    <tr>
                                                                        <td class="border-none p-0" width="100px">
                                                                            @GetLabel("CustomerEmail")
                                                                        </td>
                                                                        <td class="border-none p-0">: @Model?.CustomerDetails?.Email</td>
                                                                    </tr>
                                                                    }

                                                                    @if (GetDisplayStatus("CustomerContactNumber"))
                                                                    {
                                                                    <tr>
                                                                        <td class="border-none p-0" width="100px">@GetLabel("CustomerContactNumber")</td>
                                                                        <td class="border-none p-0">: @Model?.CustomerDetails?.ContactNumber</td>
                                                                    </tr>
                                                                    }
                                                                    </table>
                                                                </td>
                                                            </tr>
                                                            }
                                                        </tbody>
                                                    </table>
                                                </td>
                                                <td width="50%" class="border-none border-left p-0 vertical-align-top">
                                                    <table class="table-row-height">
                                                        <tbody>
                                                            @if (GetDisplayStatus("VoucherNumber") || GetDisplayStatus("VoucherDate"))
                                                            {
                                                            <tr>
                                                                @if (GetDisplayStatus("VoucherNumber")) {
                                                                <td width="50%" class="border-none border-bottom border-right vertical-align-top">
                                                                    <span>@GetLabel("VoucherNumber")</span>
                                                                    <p class="font-weight-500">@Model?.VoucherNumber</p>
                                                                </td>
                                                                }
                                                                <td width="50%" class="border-none border-bottom vertical-align-top">
                                                                    @if (GetDisplayStatus("VoucherDate")) {
                                                                    <span>@GetLabel("VoucherDate")</span>
                                                                    <p class="font-weight-500">@Model?.VoucherDate</p>
                                                                    }
                                                                </td>
                                                                @if (!GetDisplayStatus("VoucherNumber")) {
                                                                    <td width="50%" class="border-none border-bottom border-left"></td>
                                                                }
                                                            </tr>
                                                            }
                                                        </tbody>
                                                    </table>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </td>
            </tr>
        </tbody>
    </table>
</header>
